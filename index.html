<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>MATLAB代码与结果展示</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
<style>
  :root{--bg:#0b1220; --panel:#0f1724; --text:#e6eef8; --muted:#9aa9bd; --accent:#60a5fa}
  html,body{height:100%;margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .app{display:grid;grid-template-columns:2fr 1fr; gap:18px; padding:20px; height:100vh; box-sizing:border-box}
  .sidebar{background:var(--panel); border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,0.3); overflow:auto}
  .main{background:var(--panel); border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,0.3); overflow:auto}
  h1{margin:0 0 12px;font-size:18px}
  .controls{display:flex; gap:8px; align-items:center; margin-bottom:12px; flex-wrap:wrap}
  button,select{background:var(--accent); color:white; border:0; padding:6px 10px; border-radius:8px; cursor:pointer}
  button.ghost{background:transparent;color:var(--accent); border:1px solid rgba(0,0,0,0.3)}
  .small{padding:4px 6px;font-size:13px}
  .codewrap{border-radius:8px; overflow:auto; border:1px solid rgba(255,255,255,0.1); margin-top:8px; height:calc(100% - 60px);}
  pre{margin:0; padding:16px; font-size:13px; line-height:1.45; height:100%;}
  .thumbs{display:flex; gap:12px; flex-wrap:wrap; margin-top:12px}
  .thumb{width:260px; border-radius:8px; overflow:hidden; background:#1a1f30; box-shadow:0 6px 14px rgba(0,0,0,0.3); cursor:pointer}
  .thumb img{width:100%; height:160px; object-fit:contain; background:linear-gradient(180deg,#1a1f30,#0f1724)}
  .thumb .cap{padding:8px;font-size:13px; color:var(--muted)}
  /* 放大预览 */
  #overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:9999}
  #overlay img{max-width:90%; max-height:90%; border-radius:8px;}
  @media(max-width:900px){
    .app{grid-template-columns:1fr; padding:12px; height:auto}
    .sidebar{order:2; margin-bottom:12px; height:auto}
    .main{order:1}
    .thumb{width:48%}
    .codewrap{height:auto}
  }
  @media(max-width:500px){
    .thumb{width:100%}
    .controls{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>
<div class="app" id="app">
  <aside class="sidebar">
    <h1>MATLAB代码</h1>
    <div class="controls">
      <div style="display:flex;gap:8px;flex:1;flex-wrap:wrap">
        <button id="copyBtn" class="small">复制</button>
        <button id="downloadBtn" class="small">下载.m</button>
      </div>
      <select id="experimentSelect" class="small">
        <option value="0">实验一</option>
        <option value="1">实验二</option>
        <option value="2">实验三</option>
        <option value="3">实验四</option>
      </select>
    </div>
    <div class="codewrap">
      <pre><code id="codeBlock" contenteditable="true" class="language-matlab">% 在此粘贴你的 MATLAB 代码</code></pre>
    </div>
  </aside>
  <main class="main">
    <h1>结果图片</h1>
    <div class="thumbs" id="thumbs"></div>
  </main>
</div>
<div id="overlay"><img id="overlayImg" src="" alt="放大图"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
<script>
hljs.highlightAll();
const codeBlock = document.getElementById('codeBlock');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const thumbs = document.getElementById('thumbs');
const experimentSelect = document.getElementById('experimentSelect');
const overlay = document.getElementById('overlay');
const overlayImg = document.getElementById('overlayImg');

const experimentCodes = [
`%%=========================================================
%  随机信号分析：经典功率谱估计（直接法 vs 自相关法）
%=========================================================
clear; clc; close all;

%%-------------------- 参数设置 --------------------%%
N = 1024;                      % 信号长度
n = 0:N-1;                     % 时间索引
f1 = 0.1; f2 = 0.3;            % 两个信号频率
A1 = 10; A2 = 5;               % 信号幅度

%%-------------------- 信号生成 --------------------%%
x_clean = A1*sin(2*pi*f1*n + pi/3) + A2*sin(2*pi*f2*n + pi/4); % 原信号
noise = randn(1, N);           % 加性高斯白噪声
x_noisy = x_clean + noise;     % 含噪信号

%%-------------------- (1) 直接法功率谱估计 --------------------%%
Xk = fft(x_noisy, N);          % DFT 计算
freq_axis = (0:N-1)/N;         % 归一化频率轴（0~1 对应 0~2π）
P_direct = abs(Xk/N).^2;       % 功率谱密度（幅度平方归一化）

subplot(2,1,1);
plot(freq_axis, 10*log10(P_direct), 'b', 'LineWidth', 1.2);
title('直接法功率谱估计（DFT法）', 'FontSize', 13, 'FontWeight', 'bold');
xlabel('归一化频率 (×π rad/sample)');
ylabel('功率谱密度 (dB)');
grid on;
xlim([0 1]);
%set(gca, 'FontName', 'Times New Roman', 'FontSize', 11);

%%-------------------- (2) 自相关函数法功率谱估计 --------------------%%
Rxx = xcorr(x_noisy, 'biased');    % 估计自相关函数
P_corr = abs(fft(Rxx, N));         % 自相关函数的 FFT 即功率谱估计
P_corr = P_corr / max(P_corr);     % 归一化

subplot(2,1,2);
plot(freq_axis, 10*log10(P_corr), 'r', 'LineWidth', 1.2);
title('自相关函数法功率谱估计', 'FontSize', 13, 'FontWeight', 'bold');
xlabel('归一化频率 (×π rad/sample)');
ylabel('功率谱密度 (dB)');
grid on;
xlim([0 1]);
%set(gca, 'FontName', 'Times New Roman', 'FontSize', 11);


figure;
plot(freq_axis, 10*log10(P_direct/max(P_direct)), 'b', 'LineWidth', 1.5); hold on;
plot(freq_axis, 10*log10(P_corr/max(P_corr)), 'r--', 'LineWidth', 1.5);
legend('直接法', '自相关法');
xlabel('归一化频率 (×π rad/sample)');
ylabel('功率谱密度 (dB)');
title('经典功率谱估计方法对比');
grid on;


%%-------------------- 效果对比说明 --------------------%%
% 两种方法结果比较说明：
% 1. 直接法计算简单，但存在频谱泄漏（因有限长度截断）。
% 2. 自相关法通过平滑功率谱减少噪声波动，但分辨率略低。
`,
`%%===============================================================
%  随机信号分析：经典功率谱估计下的 MSE–SNR 关系（SNR控制版）
%  功能：研究频率估计精度随信噪比变化的规律
%  方法：通过指定 SNR(dB)，动态调整噪声功率
%===============================================================

clear; clc; close all;

%%-------------------- 参数设置 --------------------%%
N = 1024;                     % 信号长度
f_true = [0.1, 0.3];          % 真实频率
A = [2, 5];                   % 幅度
SNR_dB_list = -5:1:70;        % SNR 取值范围 (dB)
num_trials = 300;             % 每个 SNR 下重复实验次数（蒙特卡洛次数）

% 初始化结果存储
mse_f1 = zeros(1, length(SNR_dB_list));
mse_f2 = zeros(1, length(SNR_dB_list));

%%-------------------- 原始信号生成 --------------------%%
n = 1:N;
x_clean = A(1)*sin(2*pi*f_true(1)*n + pi/3) + ...
          A(2)*sin(2*pi*f_true(2)*n + pi/4);   % 原始信号
R_x = xcorr(x_clean);
P_signal = sum(abs(fft(R_x, N)));              % 信号功率

%%-------------------- 主循环：不同 SNR --------------------%%
fprintf("开始仿真：经典功率谱估计 MSE–SNR 分析\n");
for i = 1:length(SNR_dB_list)
    
    SNR_dB = SNR_dB_list(i);
    P_noise = P_signal / (10^(SNR_dB/10));  % 根据SNR计算噪声功率
    noise_sigma = sqrt(P_noise);            % 噪声标准差
    
    err1_sum = 0; err2_sum = 0;             % 误差累加
    
    for t = 1:num_trials
        % 生成高斯白噪声（满足当前 SNR）
        noise = noise_sigma * randn(1, N);
        y_noisy = x_clean + noise;
        
        % 功率谱估计
        R_y = xcorr(y_noisy, 'biased');
        P_y = abs(fft(R_y, N));
        
        % 仅取正频率部分
        spectrum_half = P_y(1:N/2);
        
        % 峰值检测
        [~, locs] = findpeaks(spectrum_half, 'SortStr', 'descend');
        if numel(locs) < 2
            continue; % 若噪声太强导致无法检测到两个峰，跳过
        end
        
        % 频率估计值
        f1_est = locs(2)/N;
        f2_est = locs(1)/N;
        
        % 累加误差平方
        err1_sum = err1_sum + (f1_est - f_true(1))^2;
        err2_sum = err2_sum + (f2_est - f_true(2))^2;
    end
    
    % 求平均均方误差
    mse_f1(i) = err1_sum / num_trials;
    mse_f2(i) = err2_sum / num_trials;
    
    fprintf("SNR = %2d dB 完成\n", SNR_dB);
end

fprintf("全部仿真完成 ✅\n");

%%-------------------- 绘制结果 --------------------%%
figure('Name','MSE–SNR关系图','Color','w');
plot(SNR_dB_list, mse_f1, '-ob', 'LineWidth', 1.5, 'MarkerSize', 5, 'DisplayName','MSE(f_1)');
hold on;
plot(SNR_dB_list, mse_f2, '-sr', 'LineWidth', 1.5, 'MarkerSize', 5, 'DisplayName','MSE(f_2)');
hold off;

% 图表美化
grid on;
title('经典功率谱估计下频率估计误差随SNR变化', 'FontSize', 13, 'FontWeight', 'bold');
xlabel('SNR (dB)', 'FontSize', 12);
ylabel('Mean Square Error (MSE)', 'FontSize', 12);
legend('Location','northeast');

`,
`%%===============================================================
%  随机信号分析：经典功率谱估计下的 RMSE–SNR 关系（SNR控制版）
%  功能：研究频率估计精度随信噪比变化的规律
%  方法：通过指定 SNR(dB)，动态调整噪声功率
%  指标：频率估计的 RMSE（均方根误差）
%===============================================================

clear; clc; close all;

%%-------------------- 参数设置 --------------------%%
N = 1024;                     % 信号长度
f_true = [0.1, 0.3];          % 真实频率
A = [2, 5];                   % 幅度
SNR_dB_list = -5:1:70;        % SNR 取值范围 (dB)
num_trials = 300;             % 每个 SNR 下重复实验次数（蒙特卡洛次数）

% 初始化结果存储
rmse_f1 = zeros(1, length(SNR_dB_list));
rmse_f2 = zeros(1, length(SNR_dB_list));

%%-------------------- 原始信号生成 --------------------%%
n = 1:N;
x_clean = A(1)*sin(2*pi*f_true(1)*n + pi/3) + ...
          A(2)*sin(2*pi*f_true(2)*n + pi/4);   % 原始信号
R_x = xcorr(x_clean);
P_signal = sum(abs(fft(R_x, N)));              % 信号功率

%%-------------------- 主循环：不同 SNR --------------------%%
fprintf("开始仿真：经典功率谱估计 RMSE–SNR 分析\n");
for i = 1:length(SNR_dB_list)
    
    SNR_dB = SNR_dB_list(i);
    P_noise = P_signal / (10^(SNR_dB/10));  % 根据SNR计算噪声功率
    noise_sigma = sqrt(P_noise);            % 噪声标准差
    
    err1_sum = 0; err2_sum = 0;             % 误差累加
    
    for t = 1:num_trials
        % 生成高斯白噪声（满足当前 SNR）
        noise = noise_sigma * randn(1, N);
        y_noisy = x_clean + noise;
        
        % 功率谱估计
        R_y = xcorr(y_noisy, 'biased');
        P_y = abs(fft(R_y, N));
        
        % 仅取正频率部分
        spectrum_half = P_y(1:N/2);
        
        % 峰值检测
        [~, locs] = findpeaks(spectrum_half, 'SortStr', 'descend');
        if numel(locs) < 2
            continue; % 若噪声太强导致无法检测到两个峰，跳过
        end
        
        % 频率估计值
        f1_est = locs(2)/N;
        f2_est = locs(1)/N;
        
        % 累加误差平方
        err1_sum = err1_sum + (f1_est - f_true(1))^2;
        err2_sum = err2_sum + (f2_est - f_true(2))^2;
    end
    
    % 求平均均方根误差（RMSE）
    rmse_f1(i) = sqrt(err1_sum / num_trials);
    rmse_f2(i) = sqrt(err2_sum / num_trials);
    
    fprintf("SNR = %2d dB 完成\n", SNR_dB);
end

fprintf("全部仿真完成 ✅\n");

%%-------------------- 绘制结果 --------------------%%
figure('Name','RMSE–SNR关系图','Color','w');
plot(SNR_dB_list, rmse_f1, '-ob', 'LineWidth', 1.5, 'MarkerSize', 5, 'DisplayName','RMSE(f_1)');
hold on;
plot(SNR_dB_list, rmse_f2, '-sr', 'LineWidth', 1.5, 'MarkerSize', 5, 'DisplayName','RMSE(f_2)');
hold off;

% 图表美化
grid on;
title('经典功率谱估计下频率估计 RMSE 随 SNR 变化', 'FontSize', 13, 'FontWeight', 'bold');
xlabel('SNR (dB)', 'FontSize', 12);
ylabel('Root Mean Square Error (RMSE)', 'FontSize', 12);
legend('Location','northeast');

`,
`% 实验四代码示例`
];
const experimentImages = [
  ['images/exp1_1.png','images/exp1_2.png'],
  ['images/exp2_1.png'],
  ['images/exp3_1.png'],
  ['images/exp4_1.png']
];

function loadExperiment(idx){
  codeBlock.textContent = experimentCodes[idx];
  hljs.highlightElement(codeBlock);
  thumbs.innerHTML='';
  experimentImages[idx].forEach(path=>{
    const div = document.createElement('div'); div.className='thumb';
    div.innerHTML=`<img src='${path}' alt='result'><div class='cap'>${path.split('/').pop()}</div>`;
    thumbs.appendChild(div);
  });
  document.querySelectorAll('.thumb img').forEach(img=>{
    img.onclick = ()=>{ overlayImg.src = img.src; overlay.style.display='flex'; };
  });
}

experimentSelect.addEventListener('change',e=>{ loadExperiment(e.target.value); });
loadExperiment(0);
overlay.addEventListener('click',()=>{ overlay.style.display='none'; overlayImg.src=''; });
copyBtn.addEventListener('click',async()=>{ try{ await navigator.clipboard.writeText(codeBlock.innerText); copyBtn.textContent='已复制'; setTimeout(()=>copyBtn.textContent='复制',1200); } catch(e){ alert('复制失败'); } });
downloadBtn.addEventListener('click',()=>{ const blob = new Blob([codeBlock.innerText],{type:'text/plain'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url;a.download='script.m';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url); downloadBtn.textContent='已下载'; setTimeout(()=>downloadBtn.textContent='下载.m',1200); });
</script>
</body>
</html>